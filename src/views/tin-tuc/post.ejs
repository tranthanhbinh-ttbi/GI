<!DOCTYPE html>
<html lang="vi-VN" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta name="description" content="Chi tiết tin tức. " />
    <meta name="author" content="Gender Insights" />
    <title>Chi tiết tin tức | Gender Insights</title>

    <link rel="shortcut icon" href="/photos/brands/gender-insights.ico" type="image/x-icon" />

    <link rel="preload" href="/css/components/main.css" as="style" />
    <link rel="preload" href="/css/components/bases.css" as="style" />
    <link rel="preload" href="/css/layout/post.css" as="style" />

    <link rel="stylesheet" href="/css/components/main.css" />
    <link rel="stylesheet" href="/css/components/bases.css" />
    <link rel="stylesheet" href="/fonts/index.css" />
    <link rel="stylesheet" href="/css/layout/post.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html,
        body,
        input,
        select,
        button {
            font-family: 'Montserrat', 'Segoe UI', Roboto, Arial, sans-serif;
        }

        /* Thêm style cho Messenger và Copy Link */
        .rating-stars svg {
            transition: transform 0.2s;
            fill: transparent;
            stroke: #f6ad55;
            stroke-width: 1px;
            overflow: visible;
        }

        .rating-stars svg:hover {
            transform: scale(1.2);
        }

        .rating-stars svg.filled {
            fill: #f6ad55;
            stroke: none;
        }

        .comment-item {
            border-bottom: 1px solid #eee;
            padding: 1.5rem 0;
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-author-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .comment-replies {
            margin-left: 3rem;
            margin-top: 1rem;
            border-left: 2px solid #f0f0f0;
            padding-left: 1rem;
        }

        .reply-form {
            margin-top: 1rem;
            display: none;
        }
    </style>
    <script>
        window.currentUser = <%- JSON.stringify(locals.user || null) %>;
        window.postSlug = '<%= post.slug %>';
    </script>
    <script>
        const preferredTheme = ['light', 'dark'].includes(localStorage.theme) ? localStorage.theme : (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', preferredTheme);
    </script>
</head>

<body>
    <%- include('../partials/header') %>
        <main class="post-container">
            <div class="post-main">
                <%- include('../partials/breadcrumbs', { currentPage: 'tin-tuc' , postTitle: post.title }) %>
                    <h1 class="post-title">
                        <%= post.title %>
                    </h1>
                    <div class="post-meta-top">
                        <%
                            const seed = (post.slug || '').split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                            const mockViews = 550 + (seed % 441);
                            const randomFloat = (Math.sin(seed) + 1) / 2;
                            let mockRating = 4.5 + (randomFloat * 0.5); // Range 4.5 - 5.0
                            mockRating = Math.round(mockRating * 10) / 10;
                            if (mockRating > 5) mockRating = 5;
                            const mockTotalRatings = Math.floor(mockViews / 10) + (seed % 50);
                        %>
                        <% let mainBadgeClass='bg-article' ; %>
                            <% if (post.category==='Podcast' ) mainBadgeClass='bg-podcast' ; %>
                                <% if (post.category==='Video' ) mainBadgeClass='bg-video' ; %>
                                    <span class="category-badge <%= mainBadgeClass %>">
                                        <%= post.category %>
                                    </span>
                                    <span class="post-date">
                                        <%= post.displayDate %>
                                    </span>
                    </div>

                    <article>
                        <div class="post-content">
                            <% if (post.thumbnail) { %>
                                <div class="main-image-container" style="margin-bottom: 2rem;">
                                    <img src="<%= post.thumbnail %>" alt="<%= post.title %>"
                                        style="width: 100%; height: auto; border-radius: 16px; object-fit: cover;">
                                </div>
                                <% } else { %>
                                    <div class="main-image-placeholder">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-16 h-16">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                                        </svg>
                                    </div>
                                    <% } %>

                                        <div class="markdown-body-content">
                                            <%- post.body %>
                                        </div>
                        </div>

                        <div class="rating-widget">
                            <h3 class="widget-title">Bài viết này hữu ích không?</h3>
                            <p id="rating-prompt">Nhấp vào sao để đánh giá!</p>
                            <div class="rating-stars" id="user-rating-stars">
                                <% for(let i=1; i<=5; i++) { %>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-star-fill" viewBox="0 0 16 16" data-score="<%= i %>">
                                        <path
                                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                                    </svg>
                                    <% } %>
                            </div>
                            <button id="cancel-rating-btn"
                                style="display: none; border: none; background: none; color: #dc3545; font-size: 0.85rem; margin-top: 0.5rem; cursor: pointer; text-decoration: underline;">
                                (x) Hủy đánh giá
                            </button>
                        </div>

                        <div class="rating-social-section">
                            <div class="rating-display" id="post-rating-display">
                                <div class="stars-rating">
                                    <% for(let i=1; i<=5; i++) { %>
                                        <% if (i <= Math.floor(mockRating)) { %>
                                            <span class="star"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#f6ad55" stroke="none" style="overflow: visible;" class="bi bi-star-fill" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg></span>
                                        <% } else if (i === Math.ceil(mockRating) && mockRating % 1 >= 0.3) { %>
                                            <span class="star"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="overflow: visible;" class="bi bi-star-fill">
                                                <defs>
                                                    <linearGradient id="half-star-detail-<%= i %>">
                                                        <stop offset="50%" stop-color="#f6ad55"/>
                                                        <stop offset="50%" stop-color="#e5e7eb"/>
                                                    </linearGradient>
                                                </defs>
                                                <path fill="url(#half-star-detail-<%= i %>)" d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                            </svg></span>
                                        <% } else { %>
                                            <span class="star"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="transparent" stroke="#f6ad55" stroke-width="1" style="overflow: visible;" class="bi bi-star-fill" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg></span>
                                        <% } %>
                                    <% } %>
                                </div>
                                <div class="rating-text">
                                    <span class="rating-score"><%= mockRating %></span>
                                    <span class="rating-outof">trên 5</span>
                                    <span class="rating-reviews">(<%= mockTotalRatings %> đánh giá)</span>
                                </div>
                            </div>
                            <div class="social-share-icons">
                                <a href="#" class="social-icon facebook share-btn" data-platform="facebook"
                                    title="Chia sẻ lên Facebook">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-facebook" viewBox="0 0 16 16">
                                        <path
                                            d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951" />
                                    </svg>
                                </a>
                                <a href="#" class="social-icon messenger share-btn" data-platform="messenger"
                                    title="Gửi qua Messenger">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-messenger" viewBox="0 0 16 16">
                                        <path
                                            d="M0 7.76C0 3.301 3.493 0 8 0s8 3.301 8 7.76-3.493 7.76-8 7.76c-.81 0-1.586-.107-2.316-.307a.64.64 0 0 0-.427.03l-1.588.702a.64.64 0 0 1-.898-.566l-.044-1.423a.64.64 0 0 0-.215-.456C.956 12.108 0 10.092 0 7.76m5.546-1.459-2.35 3.728c-.225.358.214.761.551.506l2.525-1.916a.48.48 0 0 1 .578-.002l1.869 1.402a1.2 1.2 0 0 0 1.735-.32l2.35-3.728c.226-.358-.214-.761-.551-.506L9.728 7.381a.48.48 0 0 1-.578.002L7.281 5.98a1.2 1.2 0 0 0-1.735.32z" />
                                    </svg>
                                </a>
                                <a href="#" class="social-icon twitter share-btn" data-platform="twitter"
                                    title="Chia sẻ lên Twitter">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-twitter-x" viewBox="0 0 16 16">
                                        <path
                                            d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                                    </svg>
                                </a>
                                <a href="#" class="social-icon copy-link share-btn" data-platform="copy"
                                    title="Sao chép liên kết">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-copy" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                                    </svg>
                                </a>
                            </div>
                        </div>

                        <section class="comments-section">
                            <h2 class="comments-title" id="comments-count">Bình luận (0)</h2>
                            <div class="comment-list" id="main-comment-list">
                                <!-- Bình luận sẽ được load bằng JavaScript -->
                                <p class="loading-text">Đang tải bình luận...</p>
                            </div>
                        </section>
                        <section class="comment-form-section">
                            <h2 class="comment-form-title">Để lại bình luận</h2>
                            <form class="comment-form" id="main-comment-form">
                                <div class="comment-form-fields">
                                    <textarea placeholder="Viết bình luận của bạn tại đây...*" required
                                        id="comment-textarea"></textarea>
                                </div>
                                <button type="submit" class="submit-btn">Gửi bình luận</button>
                            </form>
                        </section>
                    </article>
            </div>

            <aside class="post-sidebar">
                <div class="sidebar-widget">
                    <h3 class="widget-title-popular">Bài Viết Phổ Biến</h3>
                    <div class="popular-posts-list">
                        <% if (typeof popularPosts !=='undefined' && popularPosts.length> 0) { %>
                            <% popularPosts.slice(0, 5).forEach((pPost, index)=> { %>
                                <div class="post-item">
                                    <a href="/tin-tuc/<%= pPost.slug %>">
                                        <img src="<%= pPost.thumbnail || '/photos/placeholder-m6a0q.png' %>"
                                            alt="<%= pPost.title %>"
                                            onerror="this.onerror=null;this.src='/photos/placeholder-m6a0q.png';">
                                    </a>
                                    <div class="post-item-info">
                                        <div class="post-date">
                                            <%= pPost.displayDate || (pPost.date ? new
                                                Date(pPost.date).toLocaleDateString('vi-VN') : '' ) %>
                                        </div>
                                        <a href="/tin-tuc/<%= pPost.slug %>">
                                            <h4 class="post-title">
                                                <%= pPost.title %>
                                            </h4>
                                        </a>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p>Chưa có bài viết phổ biến.</p>
                                        <% } %>
                    </div>
                </div>

                <div class="sidebar-widget sidebar-widget-alt">
                    <h3 class="widget-title">Bài Viết Liên Quan</h3>
                    <span class="widget-decorator"></span>
                    <div class="related-posts-list">
                        <% if (typeof posts !=='undefined' && posts.length> 0) { %>
                            <% posts.slice(0, 5).forEach(rPost=> { %>
                                <div class="post-item">
                                    <a href="/tin-tuc/<%= rPost.slug %>">
                                        <div class="related-post-image-container">
                                            <img src="<%= rPost.thumbnail || '/photos/placeholder-m6a0q.png' %>"
                                                alt="<%= rPost.title %>"
                                                onerror="this.onerror=null;this.src='/photos/placeholder-m6a0q.png';">
                                            <% let relatedBadgeClass='bg-article' ; %>
                                                <% if (rPost.category==='Podcast' ) relatedBadgeClass='bg-podcast' ; %>
                                                    <% if (rPost.category==='Video' ) relatedBadgeClass='bg-video' ; %>
                                                        <span class="related-badge <%= relatedBadgeClass %>">
                                                            <%= rPost.category || 'Series' %>
                                                        </span>
                                        </div>
                                        <h4 class="related-post-title">
                                            <%= rPost.title %>
                                        </h4>
                                    </a>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p>Chưa có bài viết liên quan.</p>
                                        <% } %>
                    </div>
                </div>
            </aside>
        </main>
        <%- include('../partials/footer') %>
            <script src="/js/post.js?v=<%= Date.now() %>" defer></script>
</body>

</html>