<!DOCTYPE html>
<html lang="vi-VN" data-gen-themes="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta name="description"
        content="Gender Insights là dự án giáo dục giới tính cho thanh thiếu niên, đồng thời nâng cao nhận thức cộng đồng về phòng chống xâm hại tình dục trẻ em." />
    <meta name="author" content="Gender Insights" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="vi_VN" />
    <meta property="og:title" content="Gender Insights | Tin Tức" />
    <title>Gender Insights | Tin Tức</title>
    <link rel="shortcut icon" href="photos/brands/gender-insights.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/fonts/index.css" />
    <link rel="stylesheet" href="/css/components/bases.css" />
    <link rel="stylesheet" href="/css/components/main.css" />
    <link rel="stylesheet" href="/css/tin-tuc.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .radial-share-menu {
            bottom: 100%;
            right: 0;
            transform: translateY(-10px);
        }

        /* Custom button style override if needed */
        .btn-read-more {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <%- include('../partials/header') %>
        <main>
            <% let topCards=[]; if (typeof popularPosts !=='undefined' && popularPosts.length> 0) {
                topCards = popularPosts.slice(0, 4);
                }

                let featuredPost = null;
                let mainList = [];
                if (typeof posts !== 'undefined' && posts.length > 0) {
                featuredPost = posts[0];
                mainList = posts.slice(1);
                }
                %>

                <!-- TOP CARDS SECTION (Popular) -->
                <% if (topCards.length> 0) { %>
                    <section class="top-cards-section">
                        <div class="top-cards-grid">
                            <% topCards.forEach(card=> { %>
                                <div class="top-card">
                                    <div class="top-card-category">
                                        <%= card.category || 'TIN TỨC' %>
                                    </div>
                                    <div class="top-card-meta">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                            <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" />
                                            <path
                                                d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7" />
                                        </svg>
                                        <%= card.views || 0 %> - <%= card.displayDate || card.date %>
                                    </div>
                                    <h3 class="top-card-title"><a href="/tin-tuc/<%= card.slug %>"
                                            style="color:inherit; text-decoration:none;">
                                            <%= card.title %>
                                        </a></h3>
                                    <p class="top-card-description">
                                        <%= card.description %>
                                    </p>
                                </div>
                                <% }) %>
                        </div>
                    </section>
                    <% } %>

                        <!-- FEATURED ARTICLE -->
                        <% if (featuredPost) { %>
                            <section class="featured-article-section">
                                <div class="featured-article-container">
                                    <div class="featured-image-container">
                                        <% if (featuredPost.thumbnail) { %>
                                            <img src="<%= featuredPost.thumbnail %>" alt="<%= featuredPost.title %>"
                                                style="width:100%; height:100%; object-fit:cover; border-radius: 8px;">
                                            <% } else { %>
                                                <div class="featured-image-placeholder">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"
                                                        fill="#ccc" viewBox="0 0 16 16">
                                                        <path
                                                            d="M.002 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2zm1 9v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V9.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12zm5-6.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" />
                                                    </svg>
                                                </div>
                                                <% } %>
                                    </div>
                                    <div class="featured-content">
                                        <div class="featured-category">
                                            <%= featuredPost.category || 'NỔI BẬT' %>
                                        </div>
                                        <div class="featured-meta">
                                            <span class="featured-views">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                    <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" />
                                                    <path
                                                        d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7" />
                                                </svg>
                                                <%= featuredPost.views || 0 %> - <%= featuredPost.displayDate ||
                                                        featuredPost.date %>
                                            </span>
                                        </div>
                                        <h1 class="featured-title"><a href="/tin-tuc/<%= featuredPost.slug %>"
                                                style="color:inherit; text-decoration:none;">
                                                <%= featuredPost.title %>
                                            </a></h1>
                                        <p class="featured-description">
                                            <%= featuredPost.description %>
                                        </p>
                                        <div class="featured-actions">
                                            <a href="/tin-tuc/<%= featuredPost.slug %>" class="btn-read-more"
                                                style="text-decoration:none; display:inline-block; padding: 10px 20px; background: #333; color: #fff; border-radius: 4px;">Đọc
                                                bài viết</a>

                                            <div class="share-wrapper"
                                                style="position: relative; display: inline-block; margin-left: 10px;">
                                                <button class="share-icon share-action card-share-button"
                                                    title="Chia sẻ"
                                                    style="background: rgba(0,0,0,0.05); width: 40px; height: 40px;">
                                                    <i class="fa-solid fa-share-nodes"></i>
                                                </button>
                                                <!-- Radial Menu -->
                                                <div class="radial-share-menu">
                                                    <div class="radial-backdrop"></div>
                                                    <div class="radial-track">
                                                        <a href="#" class="share-item share-action"
                                                            data-platform="facebook"
                                                            data-slug="<%= featuredPost.slug %>"
                                                            data-title="<%= featuredPost.title %>" title="Facebook"><i
                                                                class="fa-brands fa-facebook"></i></a>
                                                        <a href="#" class="share-item share-action"
                                                            data-platform="messenger"
                                                            data-slug="<%= featuredPost.slug %>"
                                                            data-title="<%= featuredPost.title %>" title="Messenger"><i
                                                                class="fa-brands fa-facebook-messenger"></i></a>
                                                        <a href="#" class="share-item share-action"
                                                            data-platform="twitter" data-slug="<%= featuredPost.slug %>"
                                                            data-title="<%= featuredPost.title %>" title="Twitter"><i
                                                                class="fa-brands fa-x-twitter"></i></a>
                                                        <a href="#" class="share-item share-action" data-platform="copy"
                                                            data-slug="<%= featuredPost.slug %>"
                                                            data-title="<%= featuredPost.title %>" title="Copy"><i
                                                                class="fa-solid fa-copy"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <% } %>

                                <div class="main-content-wrapper">
                                    <section class="article-grid-section">
                                        <div class="article-grid" id="news-grid-container">
                                            <% if (mainList.length> 0) { %>
                                                <%- include('../partials/card-news', { posts: mainList }) %>
                                                    <% } else { %>
                                                        <p style="text-align:center; width:100%;">Không có tin tức nào
                                                            khác.</p>
                                                        <% } %>
                                        </div>

                                        <div class="load-more-container">
                                            <button id="btn-load-more-news" class="btn-load-more" data-type="news"
                                                data-page="2">
                                                Xem Thêm
                                            </button>
                                        </div>
                                    </section>
                                </div>
        </main>
        <%- include('../partials/footer') %>

            <script src="/js/radial-menu.js"></script>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const gridContainer = document.getElementById('news-grid-container');
                    const loadMoreBtn = document.getElementById('btn-load-more-news');
                    let currentPage = 2;

                    async function loadMore() {
                        loadMoreBtn.innerText = 'Đang tải...';
                        loadMoreBtn.disabled = true;

                        try {
                            // Assuming API handles type=news and returns appropriate HTML
                            const res = await fetch(`/api/posts?type=news&page=${currentPage}&limit=6`);
                            const data = await res.json();

                            if (data.success && data.html) {
                                gridContainer.insertAdjacentHTML('beforeend', data.html);

                                if (data.hasMore) {
                                    currentPage++;
                                    loadMoreBtn.innerText = 'Xem Thêm';
                                    loadMoreBtn.disabled = false;
                                } else {
                                    loadMoreBtn.style.display = 'none';
                                }

                                if (window.initRadialMenus) window.initRadialMenus();
                            }
                        } catch (e) {
                            console.error(e);
                            loadMoreBtn.innerText = 'Thử lại';
                            loadMoreBtn.disabled = false;
                        }
                    }

                    if (loadMoreBtn) {
                        loadMoreBtn.addEventListener('click', loadMore);
                    }

                    if (window.initRadialMenus) window.initRadialMenus();
                });
            </script>
</body>

</html>