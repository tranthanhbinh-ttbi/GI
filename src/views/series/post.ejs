<!DOCTYPE html>
<html lang="vi-VN" data-gen-themes="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta name="description" content="Chi tiết bài viết trong series. " />
    <meta name="author" content="Gender Insights" />
    <title>Chi tiết bài viết | Gender Insights</title>

    <link rel="shortcut icon" href="/photos/brands/gender-insights.ico" type="image/x-icon" />

    <link rel="preload" href="/css/components/main.css" as="style" />
    <link rel="preload" href="/css/components/bases.css" as="style" />
    <link rel="preload" href="/css/components/post.css" as="style" />

    <link rel="stylesheet" href="/css/components/main.css" />
    <link rel="stylesheet" href="/css/components/bases.css" />
    <link rel="stylesheet" href="/fonts/index.css" />
    <link rel="stylesheet" href="/css/layout/post.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html,
        body,
        input,
        select,
        button {
            font-family: 'Montserrat', 'Segoe UI', Roboto, Arial, sans-serif;
        }

        /* Thêm style cho Messenger và Copy Link */
        .social-icon.messenger { background-color: #0084FF; color: white; }
        .social-icon.copy-link { background-color: #6c757d; color: white; }
        .rating-stars svg { width: 32px; height: 32px; transition: transform 0.2s; }
        .rating-stars svg:hover { transform: scale(1.2); }
        .rating-stars svg.filled { fill: #f6ad55; stroke: #f6ad55; }
        
        .comment-item { border-bottom: 1px solid #eee; padding: 1.5rem 0; }
        .comment-item:last-child { border-bottom: none; }
        .comment-author-avatar { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
        .comment-replies { margin-left: 3rem; margin-top: 1rem; border-left: 2px solid #f0f0f0; padding-left: 1rem; }
        .reply-form { margin-top: 1rem; display: none; }
    </style>
    <script>
        window.currentUser = <%- JSON.stringify(typeof user !== 'undefined' ? user : null) %>;
        window.postSlug = '<%= post.slug %>';
    </script>
</head>

<body>
    <%- include('../partials/header') %>
        <main class="post-container">
            <div class="post-main">
                <%- include('../partials/breadcrumbs', { currentPage: 'series' , postTitle: post.title }) %>
                    <h1 class="post-title">
                        <%= post.title %>
                    </h1>
                    <div class="post-meta-top">
                        <span class="category-badge">
                            <%= post.category %>
                        </span>
                        <span class="post-date">
                            <%= post.displayDate %>
                        </span>
                        <span id="post-views-count" style="display: none; margin-left: 10px; font-size: 0.9rem; color: #666;">
                            <!-- Views will be loaded here -->
                        </span>
                    </div>

                    <article>
                        <div class="post-content">
                            <% if (post.thumbnail) { %>
                                <div class="main-image-container" style="margin-bottom: 2rem;">
                                    <img src="<%= post.thumbnail %>" alt="<%= post.title %>"
                                        style="width: 100%; height: auto; border-radius: 16px; object-fit: cover;">
                                </div>
                                <% } else { %>
                                    <div class="main-image-placeholder">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-16 h-16">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                                        </svg>
                                    </div>
                                    <% } %>

                                        <div class="markdown-body-content">
                                            <%- post.body %>
                                        </div>
                        </div>

                        <div class="rating-widget sidebar-widget sidebar-widget-alt">
                            <h3 class="widget-title">Bài viết này hữu ích không?</h3>
                            <p id="rating-prompt">Nhấp vào sao để đánh giá!</p>
                            <div class="rating-stars" id="user-rating-stars">
                                <% for(let i=1; i<=5; i++) { %>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" data-score="<%= i %>">
                                    <path
                                        d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                </svg>
                                <% } %>
                            </div>
                            <button id="cancel-rating-btn" style="display: none; border: none; background: none; color: #dc3545; font-size: 0.85rem; margin-top: 0.5rem; cursor: pointer; text-decoration: underline;">
                                (x) Hủy đánh giá
                            </button>
                        </div>

                        <div class="rating-social-section">
                            <div class="rating-display" id="post-rating-display">
                                <div class="stars-rating">
                                    <!-- Sẽ được điền bởi JavaScript -->
                                    <span class="star">☆</span>
                                    <span class="star">☆</span>
                                    <span class="star">☆</span>
                                    <span class="star">☆</span>
                                    <span class="star">☆</span>
                                </div>
                                <div class="rating-text">
                                    <span class="rating-score">0.0</span>
                                    <span class="rating-outof">trên 5</span>
                                    <span class="rating-reviews">(0 đánh giá)</span>
                                </div>
                            </div>
                            <div class="social-share-icons">
                                <a href="#" class="social-icon facebook share-btn" data-platform="facebook" title="Chia sẻ lên Facebook">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                                    </svg>
                                </a>
                                <a href="#" class="social-icon messenger share-btn" data-platform="messenger" title="Gửi qua Messenger">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 0C5.373 0 0 4.974 0 11.111c0 3.498 1.744 6.614 4.469 8.654V24l4.088-2.242c1.082.3 2.225.464 3.443.464 6.627 0 12-4.974 12-11.111C24 4.974 18.627 0 12 0zm1.293 14.333l-3.081-3.272-6.015 3.272 6.613-7.017 3.161 3.272 5.935-3.272-6.613 7.017z" />
                                    </svg>
                                </a>
                                <a href="#" class="social-icon twitter share-btn" data-platform="twitter" title="Chia sẻ lên Twitter">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
                                    </svg>
                                </a>
                                <a href="#" class="social-icon copy-link share-btn" data-platform="copy" title="Sao chép liên kết">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a3.001 3.001 0 0 0 0-4.24 3.001 3.001 0 0 0-4.24 0l-3.53 3.53a3.001 3.001 0 0 0 0 4.24zm2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.42l-.47.48a3.001 3.001 0 0 0 0 4.24 3.001 3.001 0 0 0 4.24 0l3.53-3.53a3.001 3.001 0 0 0 0-4.24z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>

                        <section class="comments-section">
                            <h2 class="comments-title" id="comments-count">Bình luận (0)</h2>
                            <div class="comment-list" id="main-comment-list">
                                <!-- Bình luận sẽ được load bằng JavaScript -->
                                <p class="loading-text">Đang tải bình luận...</p>
                            </div>
                        </section>
                        <section class="comment-form-section">
                            <h2 class="comment-form-title">Để lại bình luận</h2>
                            <form class="comment-form" id="main-comment-form">
                                <div class="comment-form-fields">
                                    <textarea placeholder="Viết bình luận của bạn tại đây...*" required id="comment-textarea"></textarea>
                                </div>
                                <button type="submit" class="submit-btn">Gửi bình luận</button>
                            </form>
                        </section>
                    </article>
            </div>

            <aside class="post-sidebar">
                <div class="sidebar-widget">
                    <h3 class="widget-title">Bài Viết Phổ Biến</h3>
                    <span class="widget-decorator"></span>
                    <div class="popular-posts-list">
                        <% if (typeof popularPosts !== 'undefined' && popularPosts.length > 0) { %>
                            <% popularPosts.slice(0, 5).forEach((pPost, index) => { %>
                                <div class="post-item">
                                    <a href="/series/post/<%= pPost.slug %>">
                                        <img src="<%= pPost.thumbnail || '/photos/placeholder-m6a0q.png' %>" alt="<%= pPost.title %>">
                                    </a>
                                    <div class="post-item-info">
                                        <div class="post-date">
                                            <%= pPost.displayDate || (pPost.date ? new Date(pPost.date).toLocaleDateString('vi-VN') : '') %>
                                        </div>
                                        <a href="/series/post/<%= pPost.slug %>">
                                            <h4 class="post-title">
                                                <%= pPost.title %>
                                            </h4>
                                        </a>
                                    </div>
                                </div>
                            <% }) %>
                        <% } else { %>
                            <p>Chưa có bài viết phổ biến.</p>
                        <% } %>
                    </div>
                </div>

                <div class="sidebar-widget sidebar-widget-alt">
                    <h3 class="widget-title">Bài Viết Liên Quan</h3>
                    <span class="widget-decorator"></span>
                    <div class="related-posts-list">
                        <% if (typeof posts !== 'undefined' && posts.length > 0) { %>
                            <% posts.slice(0, 5).forEach(rPost => { %>
                                <div class="post-item">
                                    <a href="/series/post/<%= rPost.slug %>">
                                        <div class="related-post-image-container">
                                            <img src="<%= rPost.thumbnail || '/photos/placeholder-m6a0q.png' %>" alt="<%= rPost.title %>">
                                            <span class="related-badge"><%= rPost.category || 'Series' %></span>
                                        </div>
                                        <h4 class="related-post-title">
                                            <%= rPost.title %>
                                        </h4>
                                    </a>
                                </div>
                            <% }) %>
                        <% } else { %>
                             <p>Chưa có bài viết liên quan.</p>
                        <% } %>
                    </div>
                </div>
            </aside>
        </main>
        <%- include('../partials/footer') %>
            <script src="/js/post.js" defer></script>
</body>

</html>