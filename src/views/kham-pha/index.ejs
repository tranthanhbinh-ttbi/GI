<!DOCTYPE html>
<html lang="vi-VN" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta name="description"
        content="Gender Insights là dự án giáo dục giới tính cho thanh thiếu niên, đồng thời nâng cao nhận thức cộng đồng về phòng chống xâm hại tình dục trẻ em." />
    <meta name="author" content="Gender Insights" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1" />
    <meta property="og:site_name" content="Gender Insights" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://genderinsights.vercel.app/" />
    <meta property="og:locale" content="vi_VN" />
    <meta property="og:title" content="Gender Insights | Giáo Dục Giới Tính & Phòng Chống Xâm Hại" />
    <meta property="og:description"
        content="Gender Insights là dự án giáo dục giới tính cho thanh thiếu niên, đồng thời nâng cao nhận thức cộng đồng về phòng chống xâm hại tình dục trẻ em." />
    <meta property="og:image" content="https://genderinsights.vercel.app/photos/brands/gender-insights.svg" />
    <meta property="og:image:alt" content="Gender Insights" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Gender Insights | Giáo Dục Giới Tính & Phòng Chống Xâm Hại" />
    <meta name="twitter:description"
        content="Gender Insights là dự án giáo dục giới tính cho thanh thiếu niên, đồng thời nâng cao nhận thức cộng đồng về phòng chống xâm hại tình dục trẻ em." />
    <meta name="twitter:image" content="https://genderinsights.vercel.app/photos/brands/gender-insights.svg" />
    <meta name="google-site-verification" content="WYtNJAPGpG3GU15m7LDN27dg87rSi9SSYkL4o1Oc3LQ" />
    <title>Gender Insights | Giáo Dục Giới Tính & Phòng Chống Xâm Hại</title>
    <link rel="preconnect" href="https://genderinsights.vercel.app/" crossorigin />
    <link rel="shortcut icon" href="https://genderinsights.vercel.app/photos/brands/gender-insights.ico"
        type="image/x-icon" />
    <link rel="canonical" href="https://genderinsights.vercel.app/" />
    <link rel="alternate" href="https://genderinsights.vercel.app/" hreflang="vi-VN" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="preload" href="/fonts/Montserrat/Montserrat.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
    <link rel="stylesheet" href="/fonts/index.css" />
    <link rel="stylesheet" href="/css/components/bases.css" />
    <link rel="stylesheet" href="/css/components/main.css" />
    <link rel="stylesheet" href="/css/kham-pha.css" />
    <link rel="stylesheet" href="/css/components/radial-menu.css" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css" as="style"
        onload="this.onload=null;this.rel='stylesheet'" />
    <noscript>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css" />
    </noscript>
    <link rel="prefetch" href="https://genderinsights.vercel.app/series/" />
    <link rel="prefetch" href="https://genderinsights.vercel.app/kham-pha/" />
    <link rel="prefetch" href="https://genderinsights.vercel.app/tin-tuc/" />
    <link rel="prefetch" href="https://genderinsights.vercel.app/su-kien/" />
    <link rel="prefetch" href="https://genderinsights.vercel.app/dien-dan/" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html,
        body,
        input,
        select,
        button {
            font-family: 'Montserrat', 'Segoe UI', Roboto, Arial, sans-serif;
        }
    </style>
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "@id": "https://genderinsights.vercel.app/",
            "name": "Gender Insights",
            "alternateName": "GI",
            "url": "https://genderinsights.vercel.app/",
            "logo": {
                "@type": "ImageObject",
                "url": "https://genderinsights.vercel.app/photos/brands/gender-insights.svg"
            },
            "description": "Gender Insights là dự án giáo dục giới tính cho thanh thiếu niên, đồng thời nâng cao nhận thức cộng đồng về phòng chống xâm hại tình dục trẻ em.",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "Thanh Xuân",
                "addressRegion": "Hà Nội",
                "addressCountry": "VN"
            },
            "contactPoint": [
                {
                "@type": "ContactPoint",
                "telephone": "+84-822-443-338",
                "contactType": "customer service",
                "areaServed": "VN",
                "availableLanguage": "Vietnamese"
                },
                {
                "@type": "ContactPoint",
                "telephone": "+84-377-560-931",
                "contactType": "customer service",
                "areaServed": "VN",
                "availableLanguage": "Vietnamese"
                },
                {
                "@type": "ContactPoint",
                "telephone": "+84-382-556-109",
                "contactType": "customer service",
                "areaServed": "VN",
                "availableLanguage": "Vietnamese"
                }
            ],
            "sameAs": [
                "http://www.facebook.com/GenderInsights",
                "https://www.tiktok.com/@genderinsights.no1",
                "https://open.spotify.com/show/4t3HLpqTjllUVLZ0QUFnFv?nd=1"
            ]
        }
    </script>
    <script>
        const preferredTheme = ['light', 'dark'].includes(localStorage.theme) ? localStorage.theme : (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', preferredTheme);
    </script>
</head>

<body>
    <%- include('../partials/header') %>
        <main>
            <div class="container">

                <% let heroMain=null; let heroSide=[]; let mainList=[]; let heroPostsForJs=[]; if (typeof posts
                    !=='undefined' && posts.length> 0) {
                    // Adjust: Use available posts
                    heroMain = posts[0];
                    heroSide = posts.slice(1, 4);
                    mainList = posts.slice(4);

                    // Prepare data for Client-Side Rotation
                    const top4 = posts.slice(0, 4);
                    heroPostsForJs = top4.map(p => {
                        const seed = (p.slug || '').split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                        const mockViews = 550 + (seed % 441);
                        const randomFloat = (Math.sin(seed) + 1) / 2;
                        let mockRating = 4.5 + (randomFloat * 0.5); 
                        mockRating = Math.round(mockRating * 10) / 10;
                        if (mockRating > 5) mockRating = 5;
                        const mockTotalRatings = Math.floor(mockViews / 10) + (seed % 50);

                        return {
                            id: p._id,
                            title: p.title,
                            slug: p.slug,
                            description: p.description,
                            thumbnail: p.thumbnail || '/photos/placeholder-m6a0q.png',
                            category: p.category || 'NỔI BẬT',
                            date: p.displayDate || p.date,
                            author: p.author || 'Admin',
                            views: mockViews,
                            avgRating: mockRating,
                            totalRatings: mockTotalRatings
                        };
                    });
                    }
                    %>
                    <script id="hero-posts-data" type="application/json">
    <%- JSON.stringify(heroPostsForJs) %>
</script>

                    <section class="hero-section">
                        <% if (heroMain) { %>
                            <%
                                const hmSeed = (heroMain.slug || '').split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                                const hmMockViews = 550 + (hmSeed % 441);
                                const hmRandomFloat = (Math.sin(hmSeed) + 1) / 2;
                                let hmMockRating = 4.5 + (hmRandomFloat * 0.5); 
                                hmMockRating = Math.round(hmMockRating * 10) / 10;
                                if (hmMockRating > 5) hmMockRating = 5;
                                const hmMockTotalRatings = Math.floor(hmMockViews / 10) + (hmSeed % 50);
                            %>
                            <div class="hero-main" id="hero-main-card">
                                <a href="/kham-pha/<%= heroMain.slug %>"
                                    style="display:block; width:100%; height:100%;">
                                    <img src="<%= heroMain.thumbnail || '/photos/placeholder-m6a0q.png' %>"
                                        alt="<%= heroMain.title %>" class="hero-bg"
                                        onerror="this.onerror=null;this.src='/photos/placeholder-m6a0q.png';">
                                    <div class="hero-gradient"></div>

                                    <div class="hero-top">
                                        <span class="badge-red">
                                            <%= heroMain.category || 'NỔI BẬT' %>
                                        </span>
                                        <span class="badge-date">
                                            <%= heroMain.displayDate || heroMain.date %>
                                        </span>
                                    </div>

                                    <div class="hero-content">
                                        <div class="hero-stats">
                                            <span class="author-item"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                                    height="16" fill="currentColor" class="bi bi-person-fill"
                                                    viewBox="0 0 16 16">
                                                    <path
                                                        d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                                                </svg>
                                                <%= heroMain.author || 'Admin' %>
                                                    <span class="divider">/</span>
                                            </span>
                                            <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                    <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" />
                                                    <path
                                                        d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7" />
                                                </svg>
                                                <%= hmMockViews %> lượt xem
                                                    <span class="divider">/</span>
                                            </span>
                                            <span class="stats-group"
                                                style="display:flex; align-items:center; gap:5px;">
                                                <span class="stars">
                                                    <% for(let i=1; i<=5; i++) { %>
                                                        <% if (i <= Math.floor(hmMockRating)) { %>
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#fbbf24" class="bi bi-star-fill" viewBox="0 0 16 16">
                                                                <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                            </svg>
                                                        <% } else if (i === Math.ceil(hmMockRating) && hmMockRating % 1 >= 0.3) { %>
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="bi bi-star-fill">
                                                                <defs>
                                                                    <linearGradient id="half-star-hero-main-<%= i %>">
                                                                        <stop offset="50%" stop-color="#fbbf24"/>
                                                                        <stop offset="50%" stop-color="#d1d5db"/>
                                                                    </linearGradient>
                                                                </defs>
                                                                <path fill="url(#half-star-hero-main-<%= i %>)" d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                            </svg>
                                                        <% } else { %>
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#d1d5db" class="bi bi-star-fill" viewBox="0 0 16 16">
                                                                <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                            </svg>
                                                        <% } %>
                                                    <% } %>
                                                </span>
                                                <span>(<%= hmMockTotalRatings %>)</span>
                                            </span>
                                        </div>

                                        <h2 class="hero-title">
                                            <%= heroMain.title %>
                                        </h2>
                                        <p class="hero-desc">
                                            <%= heroMain.description %>
                                        </p>
                                    </div>
                                </a>

                                <div class="share-wrapper"
                                    style="position: absolute; bottom: 30px; right: 30px; z-index: 5;">
                                    <button class="hero-share share-action card-share-button" title="Chia sẻ"><svg
                                            xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 512 512">
                                            <path
                                                d="M384 192c53 0 96-43 96-96s-43-96-96-96-96 43-96 96c0 5.4 .5 10.8 1.3 16L159.6 184.1c-16.9-15-39.2-24.1-63.6-24.1-53 0-96 43-96 96s43 96 96 96c24.4 0 46.6-9.1 63.6-24.1L289.3 400c-.9 5.2-1.3 10.5-1.3 16 0 53 43 96 96 96s96-43 96-96-43-96-96-96c-24.4 0-46.6 9.1-63.6 24.1L190.7 272c.9-5.2 1.3-10.5 1.3-16s-.5-10.8-1.3-16l129.7-72.1c16.9 15 39.2 24.1 63.6 24.1z" />
                                        </svg></button>
                                    <!-- Radial Menu -->
                                    <div class="radial-share-menu">
                                        <div class="radial-backdrop"></div>
                                        <div class="radial-track">
                                            <a href="#" class="share-item share-action" data-platform="facebook"
                                                data-slug="<%= heroMain.slug %>" data-title="<%= heroMain.title %>"
                                                title="Facebook">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                                                    <path
                                                        d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951" />
                                                </svg>
                                            </a>
                                            <a href="#" class="share-item share-action" data-platform="messenger"
                                                data-slug="<%= heroMain.slug %>" data-title="<%= heroMain.title %>"
                                                title="Messenger">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-messenger" viewBox="0 0 16 16">
                                                    <path
                                                        d="M0 7.76C0 3.301 3.493 0 8 0s8 3.301 8 7.76-3.493 7.76-8 7.76c-.81 0-1.586-.107-2.316-.307a.64.64 0 0 0-.427.03l-1.588.702a.64.64 0 0 1-.898-.566l-.044-1.423a.64.64 0 0 0-.215-.456C.956 12.108 0 10.092 0 7.76m5.546-1.459-2.35 3.728c-.225.358.214.761.551.506l2.525-1.916a.48.48 0 0 1 .578-.002l1.869 1.402a1.2 1.2 0 0 0 1.735-.32l2.35-3.728c.226-.358-.214-.761-.551-.506L9.728 7.381a.48.48 0 0 1-.578.002L7.281 5.98a1.2 1.2 0 0 0-1.735.32z" />
                                                </svg>
                                            </a>
                                            <a href="#" class="share-item share-action" data-platform="twitter"
                                                data-slug="<%= heroMain.slug %>" data-title="<%= heroMain.title %>"
                                                title="Twitter">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-twitter-x" viewBox="0 0 16 16">
                                                    <path
                                                        d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                                                </svg>
                                            </a>
                                            <a href="#" class="share-item share-action" data-platform="copy"
                                                data-slug="<%= heroMain.slug %>" data-title="<%= heroMain.title %>"
                                                title="Copy">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
                                                    <path fill-rule="evenodd"
                                                        d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                                                </svg>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } else { %>
                                <div class="hero-main"
                                    style="background:#333; display:flex; align-items:center; justify-content:center;">
                                    <p style="color:white;">Đang cập nhật...</p>
                                </div>
                                <% } %>

                                    <div class="hero-nav splide" id="hero-nav-splide">
                                        <div class="splide__track">
                                            <div class="splide__list">
                                                <% if (heroSide.length> 0) { %>
                                                    <% heroSide.forEach(sub=> { %>
                                                        <div class="nav-item splide__slide"
                                                            style="background-image: url('<%= sub.thumbnail || '/photos/placeholder-m6a0q.png' %>');">
                                                            <a href="/kham-pha/<%= sub.slug %>"
                                                                style="position:absolute; inset:0; z-index:1;"></a>
                                                            <div class="nav-overlay"></div>
                                                            <div class="nav-top">
                                                                <span class="mini-badge">
                                                                    <%= sub.category || 'Mới' %>
                                                                </span>
                                                                <span class="mini-date">
                                                                    <%= sub.displayDate || sub.date %>
                                                                </span>
                                                            </div>
                                                            <div class="nav-content">
                                                                <div class="nav-text-info">
                                                                    <div class="nav-meta-line">
                                                                        <span class="nav-author"><svg
                                                                                xmlns="http://www.w3.org/2000/svg"
                                                                                width="14" height="14"
                                                                                fill="currentColor"
                                                                                class="bi bi-person-fill"
                                                                                viewBox="0 0 16 16">
                                                                                <path
                                                                                    d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                                                                            </svg>
                                                                            <%= sub.author || 'Admin' %>
                                                                        </span>
                                                                    </div>
                                                                    <h4 class="nav-title">
                                                                        <%= sub.title %>
                                                                    </h4>
                                                                </div>
                                                                <div class="share-wrapper hero-side-share"
                                                                    style="pointer-events: auto;">
                                                                    <button
                                                                        class="nav-share-btn share-action card-share-button"
                                                                        title="Chia sẻ"
                                                                        style="width: 32px; height: 32px; border-radius: 50%; background: rgba(255,255,255,0.2); backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.3); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; padding: 0;">
                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                            width="14" height="14" fill="currentColor"
                                                                            viewBox="0 0 512 512">
                                                                            <path
                                                                                d="M384 192c53 0 96-43 96-96s-43-96-96-96-96 43-96 96c0 5.4 .5 10.8 1.3 16L159.6 184.1c-16.9-15-39.2-24.1-63.6-24.1-53 0-96 43-96 96s43 96 96 96c24.4 0 46.6-9.1 63.6-24.1L289.3 400c-.9 5.2-1.3 10.5-1.3 16 0 53 43 96 96 96s96-43 96-96-43-96-96-96c-24.4 0-46.6 9.1-63.6 24.1L190.7 272c.9-5.2 1.3-10.5 1.3-16s-.5-10.8-1.3-16l129.7-72.1c16.9 15 39.2 24.1 63.6 24.1z" />
                                                                        </svg>
                                                                    </button>
                                                                    <div class="radial-share-menu">
                                                                        <div class="radial-backdrop"></div>
                                                                        <div class="radial-track">
                                                                            <a href="#" class="share-item share-action"
                                                                                data-platform="facebook"
                                                                                data-slug="<%= sub.slug %>"
                                                                                data-title="<%= sub.title %>"
                                                                                title="Facebook">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    width="16" height="16"
                                                                                    fill="currentColor"
                                                                                    class="bi bi-facebook"
                                                                                    viewBox="0 0 16 16">
                                                                                    <path
                                                                                        d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951" />
                                                                                </svg>
                                                                            </a>
                                                                            <a href="#" class="share-item share-action"
                                                                                data-platform="messenger"
                                                                                data-slug="<%= sub.slug %>"
                                                                                data-title="<%= sub.title %>"
                                                                                title="Messenger">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    width="16" height="16"
                                                                                    fill="currentColor"
                                                                                    class="bi bi-messenger"
                                                                                    viewBox="0 0 16 16">
                                                                                    <path
                                                                                        d="M0 7.76C0 3.301 3.493 0 8 0s8 3.301 8 7.76-3.493 7.76-8 7.76c-.81 0-1.586-.107-2.316-.307a.64.64 0 0 0-.427.03l-1.588.702a.64.64 0 0 1-.898-.566l-.044-1.423a.64.64 0 0 0-.215-.456C.956 12.108 0 10.092 0 7.76m5.546-1.459-2.35 3.728c-.225.358.214.761.551.506l2.525-1.916a.48.48 0 0 1 .578-.002l1.869 1.402a1.2 1.2 0 0 0 1.735-.32l2.35-3.728c.226-.358-.214-.761-.551-.506L9.728 7.381a.48.48 0 0 1-.578.002L7.281 5.98a1.2 1.2 0 0 0-1.735.32z" />
                                                                                </svg>
                                                                            </a>
                                                                            <a href="#" class="share-item share-action"
                                                                                data-platform="twitter"
                                                                                data-slug="<%= sub.slug %>"
                                                                                data-title="<%= sub.title %>"
                                                                                title="Twitter">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    width="16" height="16"
                                                                                    fill="currentColor"
                                                                                    class="bi bi-twitter-x"
                                                                                    viewBox="0 0 16 16">
                                                                                    <path
                                                                                        d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                                                                                </svg>
                                                                            </a>
                                                                            <a href="#" class="share-item share-action"
                                                                                data-platform="copy"
                                                                                data-slug="<%= sub.slug %>"
                                                                                data-title="<%= sub.title %>"
                                                                                title="Copy">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    width="16" height="16"
                                                                                    fill="currentColor"
                                                                                    class="bi bi-copy"
                                                                                    viewBox="0 0 16 16">
                                                                                    <path fill-rule="evenodd"
                                                                                        d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                                                                                </svg>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% }) %>
                                                            <% } %>
                                            </div>
                                        </div>
                                    </div>
                    </section>

                    <div class="content-wrapper">

                        <div class="post-list" id="kham-pha-grid-container">
                            <%- include('../partials/card-kham-pha', { posts: mainList }) %>
                                <div class="load-more-container" style="margin-top: 30px;">
                                    <button id="btn-load-more-kham-pha" class="load-more-btn-styled" data-type="explore"
                                        data-page="3">
                                        Xem Thêm
                                    </button>
                                </div>
                        </div>

                        <aside class="sidebar">
                            <div class="sidebar-widget">
                                <h3 class="widget-head">Bài Viết Phổ Biến</h3>
                                <% if (typeof popularPosts !=='undefined' && popularPosts.length> 0) { %>
                                    <% popularPosts.forEach(p=> { %>
                                        <div class="pop-item">
                                            <a href="/kham-pha/<%= p.slug %>" class="pop-img"
                                                style="background-image: url('<%= p.thumbnail || '/photos/placeholder-m6a0q.png' %>'); display:block;"></a>
                                            <div class="pop-text">
                                                <a href="/kham-pha/<%= p.slug %>"
                                                    style="text-decoration:none; color:inherit;">
                                                    <span>
                                                        <%= p.displayDate || p.date %>
                                                    </span>
                                                    <h4>
                                                        <%= p.title %>
                                                    </h4>
                                                </a>
                                            </div>
                                        </div>
                                        <% }) %>
                                            <% } else { %>
                                                <p>Chưa có dữ liệu.</p>
                                                <% } %>

                            </div>
                        </aside>
                    </div>


            </div>
        </main>
        <%- include('../partials/footer') %>

            <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
            <script src="/js/radial-menu.js"></script>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    // Initialize Splide for Hero Nav
                    if (document.querySelector('#hero-nav-splide')) {
                        new Splide('#hero-nav-splide', {
                            mediaQuery: 'min',
                            breakpoints: {
                                769: {
                                    destroy: true, // Disable on desktop
                                },
                            },
                            type: 'slide',
                            perPage: 1,
                            arrows: false,
                            pagination: true,
                            gap: '15px',
                        }).mount();
                    }

                    // --- Auto Rotate Hero Section ---
                    const heroDataEl = document.getElementById('hero-posts-data');
                    if (heroDataEl) {
                        try {
                            const heroPostsData = JSON.parse(heroDataEl.textContent);

                            if (heroPostsData && heroPostsData.length > 1) {
                                let currentHeroIndex = 0;
                                const ROTATION_INTERVAL = 10000; // 10 seconds
                                let rotationTimer = null;

                                const rotateHero = () => {
                                    currentHeroIndex = (currentHeroIndex + 1) % heroPostsData.length;
                                    const count = heroPostsData.length;
                                    const mainData = heroPostsData[currentHeroIndex];

                                    // Identify Side Data
                                    const sideDataList = [];
                                    const sideSlots = document.querySelectorAll('.hero-nav .nav-item');
                                    for (let i = 0; i < sideSlots.length; i++) {
                                        const idx = (currentHeroIndex + 1 + i) % count;
                                        sideDataList.push(heroPostsData[idx]);
                                    }

                                    // --- Update Main Card ---
                                    const hMain = document.getElementById('hero-main-card') || document.querySelector('.hero-main');
                                    if (hMain) {
                                        // Update Link
                                        const link = hMain.querySelector('a');
                                        if (link) link.href = `/kham-pha/${mainData.slug}`;

                                        // Update Image
                                        const img = hMain.querySelector('.hero-bg');
                                        if (img) {
                                            img.src = mainData.thumbnail;
                                            img.alt = mainData.title;
                                        }

                                        // Update Badges
                                        const badgeCat = hMain.querySelector('.badge-red');
                                        if (badgeCat) badgeCat.innerText = mainData.category;

                                        const badgeDate = hMain.querySelector('.badge-date');
                                        if (badgeDate) badgeDate.innerText = mainData.date;

                                        // Update Author (Reconstruct HTML to keep icon)
                                        const authorSpan = hMain.querySelector('.author-item');
                                        if (authorSpan) {
                                            authorSpan.innerHTML = `
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                                                </svg>
                                                ${mainData.author}
                                                <span class="divider">/</span>
                                            `;
                                        }

                                        // Update Views
                                        const statsContainer = hMain.querySelector('.hero-stats');
                                        if (statsContainer) {
                                            // 2nd child is views
                                            const viewsSpan = statsContainer.children[1];
                                            if (viewsSpan) {
                                                viewsSpan.innerHTML = `
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                        <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" />
                                                        <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7" />
                                                    </svg>
                                                    ${mainData.views} lượt xem
                                                    <span class="divider">/</span>
                                                `;
                                            }
                                        }

                                        // Update Stars
                                        const starsContainer = hMain.querySelector('.stars');
                                        if (starsContainer) {
                                            let starsHtml = '';
                                            const rating = mainData.avgRating;
                                            for (let k = 1; k <= 5; k++) {
                                                const color = k <= Math.round(rating) ? 'var(--yellow-star)' : '#d1d5db';
                                                starsHtml += `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16" style="color: ${color};"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" /></svg>`;
                                            }
                                            starsContainer.innerHTML = starsHtml;
                                        }

                                        // Update Total Ratings
                                        const ratingCount = hMain.querySelector('.stats-group span:last-child');
                                        if (ratingCount) ratingCount.innerText = `(${mainData.totalRatings})`;

                                        // Update Content
                                        const hTitle = hMain.querySelector('.hero-title');
                                        if (hTitle) hTitle.innerText = mainData.title;

                                        const hDesc = hMain.querySelector('.hero-desc');
                                        if (hDesc) hDesc.innerText = mainData.description;

                                        // Update Share
                                        const shareItems = hMain.querySelectorAll('.radial-share-menu .share-item');
                                        shareItems.forEach(item => {
                                            item.setAttribute('data-slug', mainData.slug);
                                            item.setAttribute('data-title', mainData.title);
                                        });
                                    }

                                    // --- Update Side Cards ---
                                    sideSlots.forEach((slot, index) => {
                                        if (index >= sideDataList.length) return;
                                        const data = sideDataList[index];

                                        // BG
                                        slot.style.backgroundImage = `url('${data.thumbnail}')`;

                                        // Link
                                        const link = slot.querySelector('a');
                                        if (link) link.href = `/kham-pha/${data.slug}`;

                                        // Badge
                                        const badge = slot.querySelector('.mini-badge');
                                        if (badge) badge.innerText = data.category;

                                        // Date
                                        const date = slot.querySelector('.mini-date');
                                        if (date) date.innerText = data.date;

                                        // Author
                                        const author = slot.querySelector('.nav-author');
                                        if (author) {
                                            author.innerHTML = `
                                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                                                </svg>
                                                ${data.author}
                                            `;
                                        }

                                        // Title
                                        const title = slot.querySelector('.nav-title');
                                        if (title) title.innerText = data.title;

                                        // Share
                                        const shareItems = slot.querySelectorAll('.radial-share-menu .share-item');
                                        shareItems.forEach(item => {
                                            item.setAttribute('data-slug', data.slug);
                                            item.setAttribute('data-title', data.title);
                                        });
                                    });
                                };

                                const startRotation = () => {
                                    if (rotationTimer) clearInterval(rotationTimer);
                                    rotationTimer = setInterval(rotateHero, ROTATION_INTERVAL);
                                };

                                const stopRotation = () => {
                                    if (rotationTimer) clearInterval(rotationTimer);
                                    rotationTimer = null;
                                };

                                // Start
                                startRotation();

                                // Pause on Hover
                                const heroSection = document.querySelector('.hero-section');
                                if (heroSection) {
                                    heroSection.addEventListener('mouseenter', stopRotation);
                                    heroSection.addEventListener('mouseleave', startRotation);
                                }
                            }
                        } catch (e) {
                            console.error('Error init auto-rotate:', e);
                        }
                    }

                    const gridContainer = document.getElementById('kham-pha-grid-container');
                    const loadMoreBtn = document.getElementById('btn-load-more-kham-pha');
                    let currentPage = 3; // Start at 3 because Page 1 loaded 12 items (equiv to 2 pages of 6)

                    async function loadMore() {
                        loadMoreBtn.innerHTML = 'Đang tải...';
                        loadMoreBtn.disabled = true;

                        try {
                            const res = await fetch(`/api/posts?type=explore&page=${currentPage}&limit=6`);
                            const data = await res.json();

                            if (data.success && data.html) {
                                gridContainer.insertAdjacentHTML('beforeend', data.html);

                                if (data.hasMore) {
                                    currentPage++;
                                    loadMoreBtn.innerHTML = 'Xem Thêm';
                                    loadMoreBtn.disabled = false;
                                } else {
                                    loadMoreBtn.style.display = 'none';
                                }

                                if (window.initRadialMenus) window.initRadialMenus();
                                if (window.initShareButtons) window.initShareButtons();
                            }
                        } catch (e) {
                            console.error(e);
                            loadMoreBtn.innerHTML = 'Thử lại';
                            loadMoreBtn.disabled = false;
                        }
                    }

                    if (loadMoreBtn) {
                        loadMoreBtn.addEventListener('click', loadMore);
                    }
                    if (window.initRadialMenus) window.initRadialMenus();
                    if (window.initShareButtons) window.initShareButtons();
                });
            </script>
            <style>
                .load-more-btn-styled {
                    padding: 12px 30px;
                    background: #7986cb;
                    color: white;
                    border-radius: 12px;
                    border: none;
                    cursor: pointer;
                    font-weight: 600;
                    transition: 0.3s;
                }

                .load-more-btn-styled:hover {
                    transform: translateY(-2px);
                }
            </style>
</body>

</html>